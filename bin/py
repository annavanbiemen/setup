#!/bin/bash

# Exit on errors
set -euo pipefail

# Import libraries
source "$(dirname "$(dirname "$(realpath "${BASH_SOURCE[0]}")")")/lib/standard.sh"

# Python REPL with rich colors and optional UV version management
#
# Usage: py [python-args]
#
# Arguments:
#   python-args  Arguments to pass to Python
#
# This script runs Python 3.14 via uvx with rich library for enhanced REPL
# colors and formatting. The PYTHONSTARTUP environment variable is set to
# load custom Python startup configuration from etc/pythonrc.

# Setup Python + UV
if ! command -v uvx &> /dev/null; then
    if [[ ! -f "${HOME}/.local/bin/uvx" ]]; then
        if ! setup uv; then
            standard::raise "Failed to install uv. Please run 'setup uv' manually."
        fi
    fi
    # Verify uvx is now available
    if ! command -v uvx &> /dev/null && [[ ! -f "${HOME}/.local/bin/uvx" ]]; then
        standard::raise "uvx not found after installation. Check your PATH or run 'setup uv' manually."
    fi
fi

# Python startup script
PYTHONSTARTUP="$(dirname "$(dirname "$0")")/etc/pythonrc"
export PYTHONSTARTUP

# Download and invoke Python 3.14 using uvx
uvx --python 3.14 --with rich -- python "$@"
